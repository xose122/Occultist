<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tharok - Orc Oracle</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --parchment: #f4ece1;
            --parchment-dark: #e8dcc8;
            --ink: #2a1f1a;
            --ink-light: #4a3f3a;
            --gold: #c9a227;
            --gold-dark: #8b6914;
            --fire: #c45c26;
            --fire-light: #e07830;
            --ruby: #8b2942;
            --war: #6b1a1a;
            --life: #2d6a4f;
            --oracle: #4a1a6b;
            --border-ornate: #6b5344;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Crimson Text', Georgia, serif;
            background: radial-gradient(ellipse at 20% 20%, rgba(196, 92, 38, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(74, 26, 107, 0.08) 0%, transparent 50%),
                linear-gradient(180deg, #e8dcc8 0%, #f4ece1 50%, #e8dcc8 100%);
            min-height: 100vh; color: var(--ink); padding: 20px;
        }
        .spell-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(74, 26, 107, 0.8); z-index: 1000; justify-content: center; align-items: center;
            padding: 20px; backdrop-filter: blur(3px); }
        .spell-overlay.active { display: flex; }
        .spell-popup { background: var(--parchment); border: 3px solid var(--fire); border-radius: 8px;
            max-width: 500px; width: 100%; max-height: 80vh; overflow-y: auto;
            box-shadow: 0 0 0 1px var(--oracle), 0 10px 40px rgba(0,0,0,0.5); animation: popupIn 0.2s ease-out; }
        @keyframes popupIn { from { opacity: 0; transform: scale(0.95) translateY(-10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .spell-popup-header { background: linear-gradient(135deg, var(--fire) 0%, var(--fire-light) 100%);
            padding: 15px 20px; border-bottom: 2px solid var(--gold); position: relative; }
        .spell-popup-header.cantrip { background: linear-gradient(135deg, var(--ink-light) 0%, #5a4f4a 100%); }
        .spell-popup-header.oracle { background: linear-gradient(135deg, var(--oracle) 0%, #6a3a8b 100%); }
        .spell-popup-header.fire { background: linear-gradient(135deg, var(--fire) 0%, var(--fire-light) 100%); }
        .spell-popup-header.war { background: linear-gradient(135deg, var(--war) 0%, #8b2a2a 100%); }
        .spell-popup-header.life { background: linear-gradient(135deg, var(--life) 0%, #3d8a6f 100%); }
        .spell-popup-title { font-family: 'Cinzel', serif; font-size: 1.4rem; font-weight: 700; color: #fff; margin-bottom: 4px; }
        .spell-popup-subtitle { font-size: 0.85rem; color: rgba(255,255,255,0.8); font-style: italic; }
        .spell-popup-close { position: absolute; top: 10px; right: 15px; background: none; border: none;
            color: #fff; font-size: 1.5rem; cursor: pointer; opacity: 0.7; transition: opacity 0.2s; }
        .spell-popup-close:hover { opacity: 1; }
        .spell-popup-body { padding: 20px; }
        .spell-meta { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 15px;
            padding-bottom: 15px; border-bottom: 1px dashed var(--fire); }
        .spell-meta-item { font-size: 0.9rem; }
        .spell-meta-label { font-weight: 600; color: var(--ink-light); }
        .spell-description { font-size: 0.95rem; line-height: 1.6; }
        .spell-description p { margin-bottom: 10px; }
        .spell-description p:last-child { margin-bottom: 0; }
        .spell-upcast { margin-top: 15px; padding-top: 15px; border-top: 1px dashed var(--fire); font-size: 0.9rem; color: var(--ink-light); }
        .spell-upcast strong { color: var(--fire); }
        .spell-link { cursor: pointer; border-bottom: 1px dotted var(--ink-light); transition: all 0.2s; }
        .spell-link:hover { color: var(--fire); border-bottom-color: var(--fire); }
        .dice-toast { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.8);
            background: var(--parchment); border: 3px solid var(--fire); border-radius: 12px; padding: 25px 35px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4); z-index: 2000; text-align: center; opacity: 0;
            transition: all 0.3s ease; pointer-events: none; }
        .dice-toast.show { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        .dice-toast.crit { border-color: var(--gold); background: linear-gradient(135deg, rgba(201, 162, 39, 0.15) 0%, var(--parchment) 100%); }
        .dice-toast.fail { border-color: var(--ruby); background: linear-gradient(135deg, rgba(139, 41, 66, 0.15) 0%, var(--parchment) 100%); }
        .dice-toast-skill { font-family: 'Cinzel', serif; font-size: 0.9rem; color: var(--ink-light); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 8px; }
        .dice-toast-result { font-family: 'Cinzel', serif; font-size: 3rem; font-weight: 700; color: var(--ink); line-height: 1; }
        .dice-toast.crit .dice-toast-result { color: var(--gold-dark); }
        .dice-toast.fail .dice-toast-result { color: var(--ruby); }
        .dice-toast-breakdown { font-size: 0.9rem; color: var(--ink-light); margin-top: 8px; }
        .dice-toast-label { font-family: 'Cinzel', serif; font-size: 0.8rem; color: var(--fire); margin-top: 5px; text-transform: uppercase; letter-spacing: 0.05em; }
        .sheet { max-width: 900px; margin: 0 auto; background: var(--parchment); border: 3px solid var(--border-ornate);
            border-radius: 4px; box-shadow: 0 0 0 1px var(--fire), 0 4px 20px rgba(74, 26, 107, 0.3); padding: 30px; position: relative; }
        .sheet::before { content: ''; position: absolute; top: 8px; left: 8px; right: 8px; bottom: 8px;
            border: 1px solid var(--fire); border-radius: 2px; pointer-events: none; opacity: 0.5; }
        .header { text-align: center; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 2px solid var(--fire); position: relative; }
        .header::after { content: 'ðŸ”¥'; position: absolute; bottom: -14px; left: 50%; transform: translateX(-50%); background: var(--parchment); padding: 0 15px; font-size: 18px; }
        .character-name { font-family: 'Cinzel', serif; font-size: 3rem; font-weight: 700; color: var(--ink); text-shadow: 2px 2px 0 var(--parchment-dark); letter-spacing: 0.15em; margin-bottom: 5px; }
        .character-subtitle { font-size: 1.2rem; font-style: italic; color: var(--ink-light); letter-spacing: 0.05em; }
        .combat-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px; }
        .combat-stat { background: linear-gradient(135deg, var(--fire) 0%, var(--fire-light) 100%); border: 2px solid var(--gold-dark);
            border-radius: 8px; padding: 12px 8px; text-align: center; box-shadow: inset 0 1px 0 rgba(255,255,255,0.1), 0 3px 8px rgba(0,0,0,0.2); }
        .combat-stat-label { font-family: 'Cinzel', serif; font-size: 0.75rem; font-weight: 600; color: var(--gold); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 4px; }
        .combat-stat-value { font-family: 'Cinzel', serif; font-size: 1.8rem; font-weight: 700; color: #fff; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); }
        .combat-stat-note { font-size: 0.7rem; color: rgba(255,255,255,0.7); font-style: italic; }
        .combat-stat.initiative-roll { cursor: pointer; transition: all 0.15s ease; }
        .combat-stat.initiative-roll:hover { transform: translateY(-2px); box-shadow: inset 0 1px 0 rgba(255,255,255,0.2), 0 5px 12px rgba(0,0,0,0.3); }
        .abilities-section { margin-bottom: 25px; }
        .section-title { font-family: 'Cinzel', serif; font-size: 1.1rem; font-weight: 600; color: var(--fire); text-transform: uppercase;
            letter-spacing: 0.15em; margin-bottom: 12px; padding-bottom: 5px; border-bottom: 1px solid var(--gold); display: flex; align-items: center; gap: 10px; }
        .section-title::before, .section-title::after { content: 'â—†'; font-size: 0.6rem; color: var(--gold); }
        .abilities-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; }
        .ability-box { background: var(--parchment-dark); border: 2px solid var(--border-ornate); border-radius: 8px; padding: 10px 5px; text-align: center; position: relative; }
        .ability-box.prof { border-color: var(--fire); background: linear-gradient(135deg, rgba(196, 92, 38, 0.1) 0%, var(--parchment-dark) 100%); }
        .ability-name { font-family: 'Cinzel', serif; font-size: 0.7rem; font-weight: 600; color: var(--ink-light); text-transform: uppercase; letter-spacing: 0.1em; }
        .ability-score { font-family: 'Cinzel', serif; font-size: 1.6rem; font-weight: 700; color: var(--ink); }
        .ability-mod { font-size: 1rem; font-weight: 600; color: var(--fire); }
        .ability-separator { height: 1px; background: linear-gradient(90deg, transparent, var(--border-ornate), transparent); margin: 8px 5px; }
        .ability-save { font-family: 'Cinzel', serif; font-size: 1rem; font-weight: 700; color: var(--ink); cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: all 0.15s ease; display: inline-block; }
        .ability-save:hover { background: var(--parchment); color: var(--fire); transform: scale(1.1); }
        .ability-box.prof .ability-save { color: var(--fire); }
        .ability-box.prof .ability-save:hover { color: var(--ruby); }
        .ability-save.conc { color: var(--gold-dark); }
        .ability-save-dual { display: flex; justify-content: center; align-items: center; gap: 4px; }
        .ability-save-divider { color: var(--border-ornate); font-weight: 300; }
        .ability-save-labels { display: flex; justify-content: center; gap: 20px; font-size: 0.6rem; color: var(--ink-light); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 2px; }
        .skills-section { margin-bottom: 25px; }
        .skills-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        .skill-item { display: flex; align-items: center; background: var(--parchment-dark); border: 1px solid var(--border-ornate);
            border-radius: 4px; padding: 6px 8px; font-size: 0.85rem; min-width: 0; cursor: pointer; transition: all 0.15s ease; }
        .skill-item:hover { background: var(--parchment); transform: translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .skill-item:active { transform: translateY(0); }
        .skill-item.prof { background: linear-gradient(135deg, rgba(196, 92, 38, 0.15) 0%, rgba(196, 92, 38, 0.05) 100%); border-color: var(--fire); }
        .skill-ability { font-family: 'Cinzel', serif; font-size: 0.6rem; font-weight: 600; color: var(--ink-light); text-transform: uppercase; width: 28px; flex-shrink: 0; }
        .skill-name { flex: 1; color: var(--ink); }
        .skill-item.prof .skill-name { font-weight: 600; color: var(--fire); }
        .skill-bonus { font-family: 'Cinzel', serif; font-weight: 600; color: var(--ink); min-width: 35px; text-align: right; }
        .skill-item.prof .skill-bonus { color: var(--fire); }
        .two-columns { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
        .info-box { background: var(--parchment-dark); border: 1px solid var(--border-ornate); border-radius: 6px; padding: 15px; }
        .info-box h3 { font-family: 'Cinzel', serif; font-size: 0.9rem; font-weight: 600; color: var(--fire); text-transform: uppercase;
            letter-spacing: 0.1em; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px dashed var(--gold); }
        .info-box ul { list-style: none; }
        .info-box li { padding: 4px 0; padding-left: 18px; position: relative; font-size: 0.95rem; line-height: 1.4; }
        .info-box li::before { content: 'â€¢'; position: absolute; left: 0; color: var(--fire); }
        .rest-box { padding-bottom: 15px; }
        .rest-buttons { display: flex; flex-direction: column; gap: 10px; }
        .rest-btn { display: flex; align-items: center; gap: 12px; padding: 12px 15px; border: 2px solid var(--border-ornate);
            border-radius: 8px; background: var(--parchment); cursor: pointer; transition: all 0.2s ease; text-align: left; }
        .rest-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .rest-btn:active { transform: translateY(0); }
        .rest-btn.short-rest { border-color: var(--gold); background: linear-gradient(135deg, rgba(201, 162, 39, 0.1) 0%, var(--parchment) 100%); }
        .rest-btn.short-rest:hover { background: linear-gradient(135deg, rgba(201, 162, 39, 0.2) 0%, var(--parchment) 100%); }
        .rest-btn.long-rest { border-color: var(--oracle); background: linear-gradient(135deg, rgba(74, 26, 107, 0.1) 0%, var(--parchment) 100%); }
        .rest-btn.long-rest:hover { background: linear-gradient(135deg, rgba(74, 26, 107, 0.2) 0%, var(--parchment) 100%); }
        .rest-icon { font-size: 1.5rem; }
        .rest-label { font-family: 'Cinzel', serif; font-size: 1rem; font-weight: 600; color: var(--ink); }
        .rest-desc { font-size: 0.75rem; color: var(--ink-light); margin-left: auto; }
        .features-section { margin-bottom: 25px; }
        .feature-category { background: var(--parchment-dark); border: 1px solid var(--border-ornate); border-radius: 6px; margin-bottom: 15px; overflow: hidden; }
        .feature-category-header { background: linear-gradient(135deg, var(--fire) 0%, var(--fire-light) 100%); padding: 10px 15px;
            font-family: 'Cinzel', serif; font-size: 0.9rem; font-weight: 600; color: #fff; text-transform: uppercase; letter-spacing: 0.1em; }
        .feature-category-header.oracle { background: linear-gradient(135deg, var(--oracle) 0%, #6a3a8b 100%); }
        .feature-category-header.war { background: linear-gradient(135deg, var(--war) 0%, #8b2a2a 100%); }
        .feature-category-header.life { background: linear-gradient(135deg, var(--life) 0%, #3d8a6f 100%); }
        .feature-category-header.ruby { background: linear-gradient(135deg, var(--ruby) 0%, #ab4962 100%); }
        .feature-category-content { padding: 12px 15px; }
        .feature-item { margin-bottom: 8px; font-size: 0.9rem; line-height: 1.5; }
        .feature-item:last-child { margin-bottom: 0; }
        .feature-name { font-weight: 600; color: var(--ink); }
        .feature-sub { margin-left: 20px; color: var(--ink-light); font-size: 0.85rem; }
        .blindfold-section { margin-bottom: 20px; }
        .blindfold-box { background: linear-gradient(135deg, rgba(74, 26, 107, 0.15) 0%, var(--parchment-dark) 100%);
            border: 2px solid var(--oracle); border-radius: 8px; padding: 15px; }
        .blindfold-content { display: flex; gap: 15px; align-items: center; }
        .blindfold-toggle { background: linear-gradient(135deg, var(--oracle) 0%, #6a3a8b 100%); border: 2px solid var(--ink);
            border-radius: 8px; padding: 12px 20px; color: #fff; font-family: 'Cinzel', serif; font-weight: 600;
            font-size: 0.95rem; cursor: pointer; transition: all 0.2s; position: relative; }
        .blindfold-toggle:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(74, 26, 107, 0.4); }
        .blindfold-toggle.active { background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%); animation: pulse-glow 2s infinite; }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 5px rgba(201, 162, 39, 0.5); } 50% { box-shadow: 0 0 20px rgba(201, 162, 39, 0.8); } }
        .blindfold-deactivate { position: absolute; top: -8px; right: -8px; width: 22px; height: 22px; background: var(--ruby);
            border: 2px solid #fff; border-radius: 50%; color: #fff; font-size: 14px; font-weight: bold; cursor: pointer;
            display: none; align-items: center; justify-content: center; line-height: 1; transition: all 0.2s; }
        .blindfold-toggle.active .blindfold-deactivate { display: flex; }
        .blindfold-deactivate:hover { transform: scale(1.1); background: #a33; }
        .blindfold-info { flex: 1; }
        .blindfold-status { font-size: 0.9rem; color: var(--ink-light); margin-bottom: 4px; }
        .blindfold-status.active-status { color: var(--gold-dark); font-weight: 600; }
        .blindfold-stats { font-family: 'Cinzel', serif; font-size: 1rem; font-weight: 700; }
        .blindfold-stats .boosted { color: var(--gold-dark); }
        .trackers-section { margin-bottom: 20px; }
        .trackers-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .tracker-box { background: var(--parchment-dark); border: 1px solid var(--border-ornate); border-radius: 6px; padding: 12px; }
        .tracker-box.oracle-tracker { border-color: var(--oracle); background: linear-gradient(135deg, rgba(74, 26, 107, 0.1) 0%, var(--parchment-dark) 100%); }
        .tracker-box.orc-tracker { border-color: var(--war); background: linear-gradient(135deg, rgba(107, 26, 26, 0.1) 0%, var(--parchment-dark) 100%); }
        .tracker-box.fire-tracker { border-color: var(--fire); background: linear-gradient(135deg, rgba(196, 92, 38, 0.1) 0%, var(--parchment-dark) 100%); }
        .tracker-label { font-family: 'Cinzel', serif; font-size: 0.8rem; font-weight: 600; color: var(--ink-light); text-transform: uppercase; margin-bottom: 8px; }
        .tracker-charges { display: flex; gap: 6px; flex-wrap: wrap; }
        .tracker-charge { width: 24px; height: 24px; border: 2px solid var(--border-ornate); border-radius: 50%;
            background: var(--parchment); cursor: pointer; transition: all 0.2s; }
        .tracker-charge.used { background: var(--ink-light); }
        .tracker-box.oracle-tracker .tracker-charge { border-color: var(--oracle); }
        .tracker-box.oracle-tracker .tracker-charge.used { background: var(--oracle); }
        .tracker-box.orc-tracker .tracker-charge { border-color: var(--war); }
        .tracker-box.orc-tracker .tracker-charge.used { background: var(--war); }
        .tracker-box.fire-tracker .tracker-charge { border-color: var(--fire); }
        .tracker-box.fire-tracker .tracker-charge.used { background: var(--fire); }
        .tracker-single { display: flex; align-items: center; gap: 10px; }
        .tracker-single .tracker-charge { width: 28px; height: 28px; }
        .tracker-note { font-size: 0.8rem; color: var(--ink-light); font-style: italic; }
        .spellcasting-header { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 15px; }
        .spell-stat { background: linear-gradient(135deg, var(--fire) 0%, var(--fire-light) 100%); border: 2px solid var(--gold-dark);
            border-radius: 6px; padding: 10px; text-align: center; }
        .spell-stat-label { font-family: 'Cinzel', serif; font-size: 0.65rem; font-weight: 600; color: var(--gold);
            text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 2px; }
        .spell-stat-value { font-family: 'Cinzel', serif; font-size: 1.4rem; font-weight: 700; color: #fff; }
        .slots-section { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .slot-box { background: var(--parchment-dark); border: 1px solid var(--border-ornate); border-radius: 6px; padding: 10px; text-align: center; }
        .slot-label { font-family: 'Cinzel', serif; font-size: 0.75rem; font-weight: 600; color: var(--ink-light); text-transform: uppercase; margin-bottom: 8px; }
        .slot-checkboxes { display: flex; justify-content: center; gap: 6px; flex-wrap: wrap; }
        .slot-checkbox { width: 22px; height: 22px; cursor: pointer; accent-color: var(--fire); }
        .spell-level { background: var(--parchment-dark); border: 1px solid var(--border-ornate); border-radius: 6px; margin-bottom: 10px; overflow: hidden; }
        .spell-level-header { background: linear-gradient(135deg, var(--fire) 0%, var(--fire-light) 100%); padding: 8px 15px;
            font-family: 'Cinzel', serif; font-size: 0.85rem; font-weight: 600; color: #fff; text-transform: uppercase; letter-spacing: 0.1em; }
        .spell-level-content { padding: 12px 15px; font-size: 0.95rem; line-height: 1.8; }
        .spell-tag { font-size: 0.65rem; padding: 2px 6px; border-radius: 3px; text-transform: uppercase; font-weight: 600; vertical-align: middle; margin-left: 2px; }
        .spell-tag.oracle { background: var(--oracle); color: #fff; }
        .spell-tag.fire { background: var(--fire); color: #fff; }
        .spell-tag.war { background: var(--war); color: #fff; }
        .spell-tag.life { background: var(--life); color: #fff; }
        @media (max-width: 768px) {
            .sheet { padding: 15px; } .character-name { font-size: 2rem; }
            .combat-row { grid-template-columns: repeat(2, 1fr); } .abilities-grid { grid-template-columns: repeat(3, 1fr); }
            .skills-grid { grid-template-columns: repeat(2, 1fr); } .two-columns { grid-template-columns: 1fr; }
            .spellcasting-header { grid-template-columns: repeat(2, 1fr); } .slots-section { grid-template-columns: repeat(2, 1fr); }
            .trackers-grid { grid-template-columns: 1fr; }
        }
        @media (max-width: 480px) { .skills-grid { grid-template-columns: 1fr; } .abilities-grid { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>
    <div class="sheet">
        <div class="header">
            <h1 class="character-name">THAROK</h1>
            <p class="character-subtitle">Orc Oracle (Occultist) 7 â€¢ Investigator</p>
        </div>
        <div class="combat-row">
            <div class="combat-stat">
                <div class="combat-stat-label">Armor Class</div>
                <div class="combat-stat-value">20</div>
                <div class="combat-stat-note">13 + DEX + WIS</div>
            </div>
            <div class="combat-stat">
                <div class="combat-stat-label">Hit Points</div>
                <div class="combat-stat-value">58</div>
                <div class="combat-stat-note">7d6 + 14 + Tough</div>
            </div>
            <div class="combat-stat">
                <div class="combat-stat-label">Speed</div>
                <div class="combat-stat-value">30 ft</div>
                <div class="combat-stat-note">Orc</div>
            </div>
            <div class="combat-stat initiative-roll" data-bonus="3">
                <div class="combat-stat-label">Initiative</div>
                <div class="combat-stat-value">+3</div>
                <div class="combat-stat-note">DEX (click to roll)</div>
            </div>
        </div>
        <div class="abilities-section">
            <h2 class="section-title">Ability Scores</h2>
            <div class="abilities-grid">
                <div class="ability-box">
                    <div class="ability-name">STR</div>
                    <div class="ability-score">10</div>
                    <div class="ability-mod">+0</div>
                    <div class="ability-separator"></div>
                    <div class="ability-save" data-save="Strength" data-bonus="0">+0</div>
                </div>
                <div class="ability-box">
                    <div class="ability-name">DEX</div>
                    <div class="ability-score">16</div>
                    <div class="ability-mod">+3</div>
                    <div class="ability-separator"></div>
                    <div class="ability-save" data-save="Dexterity" data-bonus="3">+3</div>
                </div>
                <div class="ability-box">
                    <div class="ability-name">CON</div>
                    <div class="ability-score">14</div>
                    <div class="ability-mod">+2</div>
                    <div class="ability-separator"></div>
                    <div class="ability-save-dual">
                        <div class="ability-save" data-save="Constitution" data-bonus="2">+2</div>
                        <div class="ability-save-divider">|</div>
                        <div class="ability-save conc" data-save="Concentration" data-bonus="6" data-advantage="true">+6</div>
                    </div>
                    <div class="ability-save-labels"><span>save</span><span>conc</span></div>
                </div>
                <div class="ability-box">
                    <div class="ability-name">INT</div>
                    <div class="ability-score">12</div>
                    <div class="ability-mod">+1</div>
                    <div class="ability-separator"></div>
                    <div class="ability-save" data-save="Intelligence" data-bonus="1">+1</div>
                </div>
                <div class="ability-box prof">
                    <div class="ability-name">WIS</div>
                    <div class="ability-score">18</div>
                    <div class="ability-mod">+4</div>
                    <div class="ability-separator"></div>
                    <div class="ability-save" data-save="Wisdom" data-bonus="7">+7</div>
                </div>
                <div class="ability-box prof">
                    <div class="ability-name">CHA</div>
                    <div class="ability-score">12</div>
                    <div class="ability-mod">+1</div>
                    <div class="ability-separator"></div>
                    <div class="ability-save" data-save="Charisma" data-bonus="4">+4</div>
                </div>
            </div>
        </div>
        <div class="skills-section">
            <h2 class="section-title">Skills</h2>
            <div class="skills-grid">
                <div class="skill-item" data-skill="Acrobatics" data-bonus="3"><span class="skill-ability">DEX</span><span class="skill-name">Acrobatics</span><span class="skill-bonus">+3</span></div>
                <div class="skill-item" data-skill="Animal Handling" data-bonus="4"><span class="skill-ability">WIS</span><span class="skill-name">Animal Handling</span><span class="skill-bonus">+4</span></div>
                <div class="skill-item" data-skill="Arcana" data-bonus="1"><span class="skill-ability">INT</span><span class="skill-name">Arcana</span><span class="skill-bonus">+1</span></div>
                <div class="skill-item" data-skill="Athletics" data-bonus="0"><span class="skill-ability">STR</span><span class="skill-name">Athletics</span><span class="skill-bonus">+0</span></div>
                <div class="skill-item" data-skill="Deception" data-bonus="1"><span class="skill-ability">CHA</span><span class="skill-name">Deception</span><span class="skill-bonus">+1</span></div>
                <div class="skill-item prof" data-skill="History" data-bonus="4"><span class="skill-ability">INT</span><span class="skill-name">History</span><span class="skill-bonus">+4</span></div>
                <div class="skill-item prof" data-skill="Insight" data-bonus="7"><span class="skill-ability">WIS</span><span class="skill-name">Insight</span><span class="skill-bonus">+7</span></div>
                <div class="skill-item" data-skill="Intimidation" data-bonus="1"><span class="skill-ability">CHA</span><span class="skill-name">Intimidation</span><span class="skill-bonus">+1</span></div>
                <div class="skill-item" data-skill="Investigation" data-bonus="1"><span class="skill-ability">INT</span><span class="skill-name">Investigation</span><span class="skill-bonus">+1</span></div>
                <div class="skill-item" data-skill="Medicine" data-bonus="4"><span class="skill-ability">WIS</span><span class="skill-name">Medicine</span><span class="skill-bonus">+4</span></div>
                <div class="skill-item" data-skill="Nature" data-bonus="1"><span class="skill-ability">INT</span><span class="skill-name">Nature</span><span class="skill-bonus">+1</span></div>
                <div class="skill-item prof" data-skill="Perception" data-bonus="7"><span class="skill-ability">WIS</span><span class="skill-name">Perception</span><span class="skill-bonus">+7</span></div>
                <div class="skill-item" data-skill="Performance" data-bonus="1"><span class="skill-ability">CHA</span><span class="skill-name">Performance</span><span class="skill-bonus">+1</span></div>
                <div class="skill-item" data-skill="Persuasion" data-bonus="1"><span class="skill-ability">CHA</span><span class="skill-name">Persuasion</span><span class="skill-bonus">+1</span></div>
                <div class="skill-item" data-skill="Religion" data-bonus="1"><span class="skill-ability">INT</span><span class="skill-name">Religion</span><span class="skill-bonus">+1</span></div>
                <div class="skill-item" data-skill="Sleight of Hand" data-bonus="3"><span class="skill-ability">DEX</span><span class="skill-name">Sleight of Hand</span><span class="skill-bonus">+3</span></div>
                <div class="skill-item" data-skill="Stealth" data-bonus="3"><span class="skill-ability">DEX</span><span class="skill-name">Stealth</span><span class="skill-bonus">+3</span></div>
                <div class="skill-item prof" data-skill="Survival" data-bonus="7"><span class="skill-ability">WIS</span><span class="skill-name">Survival</span><span class="skill-bonus">+7</span></div>
            </div>
        </div>
        <div class="two-columns">
            <div class="info-box">
                <h3>Proficiencies</h3>
                <ul>
                    <li><strong>Armor:</strong> Light armor</li>
                    <li><strong>Weapons:</strong> Simple (WIS to atk/dmg)</li>
                    <li><strong>Languages:</strong> Common, Orc, Draconic</li>
                    <li><strong>Senses:</strong> Darkvision 120 ft, Blindsight 15 ft</li>
                </ul>
            </div>
            <div class="info-box rest-box">
                <h3>Rest</h3>
                <div class="rest-buttons">
                    <button class="rest-btn short-rest" onclick="shortRest()">
                        <span class="rest-icon">â˜€</span>
                        <span class="rest-label">Short Rest</span>
                        <span class="rest-desc">Adrenaline Rush</span>
                    </button>
                    <button class="rest-btn long-rest" onclick="longRest()">
                        <span class="rest-icon">â˜½</span>
                        <span class="rest-label">Long Rest</span>
                        <span class="rest-desc">All resources</span>
                    </button>
                </div>
            </div>
        </div>
        <div class="features-section">
            <h2 class="section-title">Features & Traits</h2>
            <div class="feature-category">
                <div class="feature-category-header">Orc Traits</div>
                <div class="feature-category-content">
                    <div class="feature-item"><span class="feature-name">Darkvision:</span> 120 feet</div>
                    <div class="feature-item"><span class="feature-name">Adrenaline Rush:</span> BA Dash, gain 3 temp HP (Prof/Short Rest)</div>
                    <div class="feature-item"><span class="feature-name">Relentless Endurance:</span> Drop to 1 HP instead of 0 (1/Long Rest)</div>
                </div>
            </div>
            <div class="feature-category">
                <div class="feature-category-header oracle">Oracle Features</div>
                <div class="feature-category-content">
                    <div class="feature-item"><span class="feature-name">Oracle's Sight:</span> Blindsight 15 ft (30 ft while Blinded 1+ min)</div>
                    <div class="feature-item"><span class="feature-name">Fate Reading</span> (Reaction): When hit, +4 AC until next turn. Augury at will</div>
                    <div class="feature-item"><span class="feature-name">Enlightened Understanding:</span> Gain 4 temp HP on Revelation. Can trigger on any 1st+ spell</div>
                </div>
            </div>
            <div class="feature-category">
                <div class="feature-category-header">Mystery of Fire</div>
                <div class="feature-category-content">
                    <div class="feature-item"><span class="feature-name">Spells:</span> Burning Hands, Continual Flame, Fireball, Fire Shield</div>
                    <div class="feature-item"><span class="feature-name">Touch of Fire (BA):</span> Take 1 fire, weapon +1d6 fire for 1 min</div>
                    <div class="feature-item"><span class="feature-name">Revelation of Fire:</span> On fire spell 1st+: half cover, melee attackers take 1d6 fire, 1 fire at start of turn, +4 temp HP</div>
                </div>
            </div>
            <div class="feature-category">
                <div class="feature-category-header war">Mystery of War</div>
                <div class="feature-category-content">
                    <div class="feature-item"><span class="feature-name">Spells:</span> Bless, Iron Wind Strike, Whirling Conflagration, Dimension Cutter</div>
                    <div class="feature-item"><span class="feature-name">Revelation of War:</span> On spell/cantrip: BA melee weapon attack, +4 temp HP</div>
                </div>
            </div>
            <div class="feature-category">
                <div class="feature-category-header life">Mystery of Life</div>
                <div class="feature-category-content">
                    <div class="feature-item">Spells: Healing Word, Aid, Mass Healing Word, Vital Surge</div>
                </div>
            </div>
            <div class="feature-category">
                <div class="feature-category-header ruby">War Caster</div>
                <div class="feature-category-content">
                    <div class="feature-item"><span class="feature-name">Concentration:</span> Advantage on CON saves</div>
                    <div class="feature-item"><span class="feature-name">Reactive Spell:</span> Cast spell as opportunity attack</div>
                    <div class="feature-item"><span class="feature-name">Somatic:</span> Can cast with weapons/shield in hands</div>
                </div>
            </div>
        </div>
        <div class="blindfold-section">
            <h2 class="section-title">Runed Blindfold</h2>
            <div class="blindfold-box">
                <div class="blindfold-content">
                    <button class="blindfold-toggle active" id="blindfoldBtn" onclick="toggleBlindfold()">
                        Blindfold ON
                        <span class="blindfold-deactivate" onclick="event.stopPropagation(); removeBlindfold()">Ã—</span>
                    </button>
                    <div class="blindfold-info">
                        <div class="blindfold-status active-status" id="blindfoldStatus">+1 Spell DC & Attack</div>
                        <div class="blindfold-stats">
                            Spell DC: <span id="currentDC" class="boosted">17</span> | Attack: <span id="currentSpellAtk" class="boosted">+8</span>
                        </div>
                        <div class="blindfold-stats" style="margin-top: 4px; font-size: 0.9rem;">
                            Weapon: <span id="currentWeaponAtk">+7</span> atk / <span id="currentWeaponDmg">+4</span> dmg
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="blindfold-section">
            <h2 class="section-title">Touch of Fire</h2>
            <div class="blindfold-box" style="border-color: var(--fire); background: linear-gradient(135deg, rgba(196, 92, 38, 0.15) 0%, var(--parchment-dark) 100%);">
                <div class="blindfold-content">
                    <button class="blindfold-toggle" id="touchFireBtn" onclick="toggleTouchOfFire()" style="background: linear-gradient(135deg, var(--fire) 0%, var(--fire-light) 100%);">
                        Inactive
                        <span class="blindfold-deactivate" onclick="event.stopPropagation(); deactivateTouchOfFire()">Ã—</span>
                    </button>
                    <div class="blindfold-info">
                        <div class="blindfold-status" id="touchFireStatus">Weapon not ignited</div>
                        <div class="blindfold-stats" id="touchFireEffect" style="font-size: 0.9rem; color: var(--ink-light);">
                            BA to activate: Take 1 fire damage
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="trackers-section">
            <h2 class="section-title">Resources</h2>
            <div class="trackers-grid">
                <div class="tracker-box oracle-tracker">
                    <div class="tracker-label">Fate Reading (4/Long Rest)</div>
                    <div class="tracker-charges">
                        <div class="tracker-charge" onclick="toggleCharge(this)"></div>
                        <div class="tracker-charge" onclick="toggleCharge(this)"></div>
                        <div class="tracker-charge" onclick="toggleCharge(this)"></div>
                        <div class="tracker-charge" onclick="toggleCharge(this)"></div>
                    </div>
                </div>
                <div class="tracker-box orc-tracker">
                    <div class="tracker-label">Adrenaline Rush (3/Short Rest)</div>
                    <div class="tracker-charges">
                        <div class="tracker-charge" onclick="toggleCharge(this)"></div>
                        <div class="tracker-charge" onclick="toggleCharge(this)"></div>
                        <div class="tracker-charge" onclick="toggleCharge(this)"></div>
                    </div>
                </div>
                <div class="tracker-box orc-tracker">
                    <div class="tracker-label">Relentless Endurance (1/Long Rest)</div>
                    <div class="tracker-single">
                        <div class="tracker-charge" onclick="toggleCharge(this)"></div>
                        <span class="tracker-note">Drop to 1 HP instead of 0</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="spellcasting-section">
            <h2 class="section-title">Spellcasting</h2>
            <div class="spellcasting-header">
                <div class="spell-stat">
                    <div class="spell-stat-label">Spell Save DC</div>
                    <div class="spell-stat-value" id="spellDCDisplay">17</div>
                </div>
                <div class="spell-stat">
                    <div class="spell-stat-label">Spell Attack</div>
                    <div class="spell-stat-value" id="spellAtkDisplay">+8</div>
                </div>
                <div class="spell-stat">
                    <div class="spell-stat-label">Ability</div>
                    <div class="spell-stat-value">WIS</div>
                </div>
                <div class="spell-stat">
                    <div class="spell-stat-label">Weapon Atk</div>
                    <div class="spell-stat-value" id="weaponAtkDisplay">+7</div>
                </div>
            </div>
            <div class="slots-section">
                <div class="slot-box">
                    <div class="slot-label">1st Level</div>
                    <div class="slot-checkboxes">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                    </div>
                </div>
                <div class="slot-box">
                    <div class="slot-label">2nd Level</div>
                    <div class="slot-checkboxes">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                    </div>
                </div>
                <div class="slot-box">
                    <div class="slot-label">3rd Level</div>
                    <div class="slot-checkboxes">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                    </div>
                </div>
                <div class="slot-box">
                    <div class="slot-label">4th Level</div>
                    <div class="slot-checkboxes">
                        <input type="checkbox" class="slot-checkbox">
                    </div>
                </div>
            </div>
            <div class="spell-level">
                <div class="spell-level-header">Cantrips</div>
                <div class="spell-level-content">
                    <span class="spell-link" data-spell="burn">Burn</span> <span class="spell-tag fire">Fire</span>, 
                    <span class="spell-link" data-spell="true-strike">True Strike</span>, 
                    <span class="spell-link" data-spell="electric-arc">Electric Arc</span>, 
                    <span class="spell-link" data-spell="guidance">Guidance</span>, 
                    <span class="spell-link" data-spell="ice-weapon">Ice Weapon</span>, 
                    <span class="spell-link" data-spell="light">Light</span>
                </div>
            </div>
            <div class="spell-level">
                <div class="spell-level-header">1st Level</div>
                <div class="spell-level-content">
                    <span class="spell-link" data-spell="identify">Identify</span> <span class="spell-tag oracle">Oracle</span>, 
                    <span class="spell-link" data-spell="burning-hands">Burning Hands</span> <span class="spell-tag fire">Fire</span>, 
                    <span class="spell-link" data-spell="bless">Bless</span> <span class="spell-tag war">War</span>, 
                    <span class="spell-link" data-spell="healing-word">Healing Word</span> <span class="spell-tag life">Life</span>, 
                    <span class="spell-link" data-spell="absorb-elements">Absorb Elements</span>, 
                    <span class="spell-link" data-spell="detect-magic">Detect Magic</span>
                </div>
            </div>
            <div class="spell-level">
                <div class="spell-level-header">2nd Level</div>
                <div class="spell-level-content">
                    <span class="spell-link" data-spell="locate-object">Locate Object</span> <span class="spell-tag oracle">Oracle</span>, 
                    <span class="spell-link" data-spell="continual-flame">Continual Flame</span> <span class="spell-tag fire">Fire</span>, 
                    <span class="spell-link" data-spell="iron-wind-strike">Iron Wind Strike</span> <span class="spell-tag war">War</span>, 
                    <span class="spell-link" data-spell="aid">Aid</span> <span class="spell-tag life">Life</span>, 
                    <span class="spell-link" data-spell="enhance-ability">Enhance Ability</span>, 
                    <span class="spell-link" data-spell="invisibility">Invisibility</span>, 
                    <span class="spell-link" data-spell="misty-step">Misty Step</span>
                </div>
            </div>
            <div class="spell-level">
                <div class="spell-level-header">3rd Level</div>
                <div class="spell-level-content">
                    <span class="spell-link" data-spell="clairvoyance">Clairvoyance</span> <span class="spell-tag oracle">Oracle</span>, 
                    <span class="spell-link" data-spell="fireball">Fireball</span> <span class="spell-tag fire">Fire</span>, 
                    <span class="spell-link" data-spell="whirling-conflagration">Whirling Conflagration</span> <span class="spell-tag war">War</span>, 
                    <span class="spell-link" data-spell="mass-healing-word">Mass Healing Word</span> <span class="spell-tag life">Life</span>, 
                    <span class="spell-link" data-spell="spirit-guardians">Spirit Guardians</span>, 
                    <span class="spell-link" data-spell="counterspell">Counterspell</span>
                </div>
            </div>
            <div class="spell-level">
                <div class="spell-level-header">4th Level</div>
                <div class="spell-level-content">
                    <span class="spell-link" data-spell="locate-creature">Locate Creature</span> <span class="spell-tag oracle">Oracle</span>, 
                    <span class="spell-link" data-spell="fire-shield">Fire Shield</span> <span class="spell-tag fire">Fire</span>, 
                    <span class="spell-link" data-spell="dimension-cutter">Dimension Cutter</span> <span class="spell-tag war">War</span>, 
                    <span class="spell-link" data-spell="vital-surge">Vital Surge</span> <span class="spell-tag life">Life</span>, 
                    <span class="spell-link" data-spell="conjure-woodland-beings">Conjure Woodland Beings</span>, 
                    <span class="spell-link" data-spell="banishment">Banishment</span>
                </div>
            </div>
            <div class="spell-level" style="margin-top: 20px;">
                <div class="spell-level-header" style="background: linear-gradient(135deg, var(--war) 0%, #8b2a2a 100%);">Weapons</div>
                <div class="spell-level-content">
                    <strong>Quarterstaff:</strong> +7 to hit, 1d6+4 bludg (versatile 1d8+4)<br>
                    <strong>Ice Weapon:</strong> +7 to hit, cold damage (Spear 1d6, Sword 1d6/1d8, Lance 1d8 reach, Hammer 1d10, Dagger 1d4 finesse)
                </div>
            </div>
        </div>
    </div>
    <div class="spell-overlay" id="spellOverlay">
        <div class="spell-popup">
            <div class="spell-popup-header" id="spellHeader">
                <h3 class="spell-popup-title" id="spellTitle"></h3>
                <p class="spell-popup-subtitle" id="spellSubtitle"></p>
                <button class="spell-popup-close" onclick="closeSpellPopup()">Ã—</button>
            </div>
            <div class="spell-popup-body">
                <div class="spell-meta" id="spellMeta"></div>
                <div class="spell-description" id="spellDescription"></div>
                <div class="spell-upcast" id="spellUpcast"></div>
            </div>
        </div>
    </div>
    <div class="dice-toast" id="diceToast">
        <div class="dice-toast-skill" id="diceSkill"></div>
        <div class="dice-toast-result" id="diceResult"></div>
        <div class="dice-toast-breakdown" id="diceBreakdown"></div>
        <div class="dice-toast-label" id="diceLabel"></div>
    </div>
    <script>
        const STORAGE_KEY = 'tharok_character_sheet';
        let blindfoldActive = true;
        let touchOfFireActive = false;

        function saveState() {
            const state = {
                spellSlots: [],
                trackerCharges: [],
                blindfoldActive: blindfoldActive,
                touchOfFireActive: touchOfFireActive
            };
            document.querySelectorAll('.slot-checkbox').forEach(cb => state.spellSlots.push(cb.checked));
            document.querySelectorAll('.tracker-charge').forEach(charge => state.trackerCharges.push(charge.classList.contains('used')));
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        }

        function loadState() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (!saved) return;
            try {
                const state = JSON.parse(saved);
                document.querySelectorAll('.slot-checkbox').forEach((cb, i) => { if (state.spellSlots[i]) cb.checked = state.spellSlots[i]; });
                document.querySelectorAll('.tracker-charge').forEach((charge, i) => { if (state.trackerCharges[i]) charge.classList.add('used'); });
                blindfoldActive = state.blindfoldActive !== undefined ? state.blindfoldActive : true;
                if (blindfoldActive) activateBlindfold(); else removeBlindfold();
                touchOfFireActive = state.touchOfFireActive || false;
                if (touchOfFireActive) activateTouchOfFire();
            } catch (e) { console.error('Error loading state:', e); }
        }

        function setupAutoSave() {
            document.querySelectorAll('.slot-checkbox').forEach(cb => cb.addEventListener('change', saveState));
        }

        document.addEventListener('DOMContentLoaded', () => { loadState(); setupAutoSave(); });

        function toggleCharge(el) { el.classList.toggle('used'); saveState(); }

        function toggleBlindfold() { if (!blindfoldActive) activateBlindfold(); }
        function activateBlindfold() {
            blindfoldActive = true;
            const btn = document.getElementById('blindfoldBtn');
            btn.classList.add('active');
            btn.childNodes[0].textContent = 'Blindfold ON ';
            document.getElementById('blindfoldStatus').textContent = '+1 Spell DC & Attack';
            document.getElementById('blindfoldStatus').classList.add('active-status');
            document.getElementById('currentDC').innerHTML = '<span class="boosted">17</span>';
            document.getElementById('currentSpellAtk').innerHTML = '<span class="boosted">+8</span>';
            document.getElementById('currentWeaponAtk').textContent = '+7';
            document.getElementById('currentWeaponDmg').textContent = '+4';
            document.getElementById('spellDCDisplay').textContent = '17';
            document.getElementById('spellAtkDisplay').textContent = '+8';
            document.getElementById('weaponAtkDisplay').textContent = '+7';
            saveState();
        }
        function removeBlindfold() {
            blindfoldActive = false;
            const btn = document.getElementById('blindfoldBtn');
            btn.classList.remove('active');
            btn.childNodes[0].textContent = 'Blindfold OFF ';
            document.getElementById('blindfoldStatus').textContent = '+1 Weapon Attack & Damage';
            document.getElementById('blindfoldStatus').classList.remove('active-status');
            document.getElementById('currentDC').textContent = '16';
            document.getElementById('currentSpellAtk').textContent = '+7';
            document.getElementById('currentWeaponAtk').innerHTML = '<span class="boosted">+8</span>';
            document.getElementById('currentWeaponDmg').innerHTML = '<span class="boosted">+5</span>';
            document.getElementById('spellDCDisplay').textContent = '16';
            document.getElementById('spellAtkDisplay').textContent = '+7';
            document.getElementById('weaponAtkDisplay').textContent = '+8';
            saveState();
        }

        function shortRest() {
            document.querySelectorAll('.orc-tracker .tracker-charge').forEach(c => c.classList.remove('used'));
            saveState();
            showRestToast('Short Rest', 'Adrenaline Rush restored');
        }
        function longRest() {
            document.querySelectorAll('.slot-checkbox').forEach(cb => cb.checked = false);
            document.querySelectorAll('.tracker-charge').forEach(c => c.classList.remove('used'));
            deactivateTouchOfFire();
            saveState();
            showRestToast('Long Rest', 'All resources restored');
        }

        function toggleTouchOfFire() { if (!touchOfFireActive) activateTouchOfFire(); }
        function activateTouchOfFire() {
            touchOfFireActive = true;
            const btn = document.getElementById('touchFireBtn');
            btn.classList.add('active');
            btn.style.background = 'linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%)';
            btn.childNodes[0].textContent = 'ACTIVE ';
            document.getElementById('touchFireStatus').textContent = 'Weapon ignited (1 min)';
            document.getElementById('touchFireStatus').classList.add('active-status');
            document.getElementById('touchFireEffect').innerHTML = '<span class="boosted">+1d6 fire damage</span> â€¢ Light 10ft/10ft';
            saveState();
        }
        function deactivateTouchOfFire() {
            touchOfFireActive = false;
            const btn = document.getElementById('touchFireBtn');
            btn.classList.remove('active');
            btn.style.background = 'linear-gradient(135deg, var(--fire) 0%, var(--fire-light) 100%)';
            btn.childNodes[0].textContent = 'Inactive ';
            document.getElementById('touchFireStatus').textContent = 'Weapon not ignited';
            document.getElementById('touchFireStatus').classList.remove('active-status');
            document.getElementById('touchFireEffect').innerHTML = 'BA to activate: Take 1 fire damage';
            saveState();
        }

        let diceToastTimeout = null;
        function rollD20() { return Math.floor(Math.random() * 20) + 1; }
        function showDiceRoll(skillName, bonus) {
            const roll = rollD20();
            const total = roll + bonus;
            const toast = document.getElementById('diceToast');
            document.getElementById('diceSkill').textContent = skillName;
            document.getElementById('diceResult').textContent = total;
            document.getElementById('diceBreakdown').textContent = `ðŸŽ² ${roll} ${bonus >= 0 ? '+' : ''}${bonus}`;
            toast.classList.remove('crit', 'fail');
            if (roll === 20) { toast.classList.add('crit'); document.getElementById('diceLabel').textContent = 'Â¡Natural 20!'; }
            else if (roll === 1) { toast.classList.add('fail'); document.getElementById('diceLabel').textContent = 'Natural 1...'; }
            else { document.getElementById('diceLabel').textContent = ''; }
            if (diceToastTimeout) clearTimeout(diceToastTimeout);
            toast.classList.add('show');
            diceToastTimeout = setTimeout(() => toast.classList.remove('show'), 2000);
        }
        function showRestToast(title, message) {
            const toast = document.getElementById('diceToast');
            document.getElementById('diceSkill').textContent = title;
            document.getElementById('diceResult').textContent = 'âœ“';
            document.getElementById('diceBreakdown').textContent = message;
            document.getElementById('diceLabel').textContent = '';
            toast.classList.remove('crit', 'fail');
            toast.classList.add('show');
            if (diceToastTimeout) clearTimeout(diceToastTimeout);
            diceToastTimeout = setTimeout(() => toast.classList.remove('show'), 2000);
        }

        document.querySelectorAll('.skill-item').forEach(item => {
            item.addEventListener('click', function() { showDiceRoll(this.dataset.skill, parseInt(this.dataset.bonus)); });
        });
        document.querySelectorAll('.ability-save').forEach(item => {
            item.addEventListener('click', function(e) {
                e.stopPropagation();
                if (this.dataset.advantage === 'true') {
                    showAdvantageRoll(this.dataset.save, parseInt(this.dataset.bonus));
                } else {
                    showDiceRoll(this.dataset.save + ' Save', parseInt(this.dataset.bonus));
                }
            });
        });
        document.querySelector('.initiative-roll').addEventListener('click', function(e) {
            e.stopPropagation();
            showDiceRoll('Initiative', parseInt(this.dataset.bonus));
        });

        // Make spell stats clickable for attack rolls
        document.querySelectorAll('.spell-stat').forEach(stat => {
            const label = stat.querySelector('.spell-stat-label');
            if (label && (label.textContent.includes('Attack') || label.textContent.includes('Weapon'))) {
                stat.style.cursor = 'pointer';
                stat.addEventListener('click', function() {
                    const value = this.querySelector('.spell-stat-value').textContent;
                    const bonus = parseInt(value.replace('+', ''));
                    const type = label.textContent.includes('Spell') ? 'Spell Attack' : 'Weapon Attack';
                    showDiceRoll(type, bonus);
                });
                stat.addEventListener('mouseenter', function() { this.style.transform = 'translateY(-2px)'; this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)'; });
                stat.addEventListener('mouseleave', function() { this.style.transform = ''; this.style.boxShadow = ''; });
            }
        });

        function showAdvantageRoll(skillName, bonus) {
            const roll1 = rollD20();
            const roll2 = rollD20();
            const bestRoll = Math.max(roll1, roll2);
            const total = bestRoll + bonus;
            const toast = document.getElementById('diceToast');
            document.getElementById('diceSkill').textContent = skillName;
            document.getElementById('diceResult').textContent = total;
            document.getElementById('diceBreakdown').textContent = `ðŸŽ² ${roll1} | ${roll2} â†’ ${bestRoll} ${bonus >= 0 ? '+' : ''}${bonus}`;
            toast.classList.remove('crit', 'fail');
            if (bestRoll === 20) { toast.classList.add('crit'); document.getElementById('diceLabel').textContent = 'Â¡Natural 20! (Advantage)'; }
            else if (roll1 === 1 && roll2 === 1) { toast.classList.add('fail'); document.getElementById('diceLabel').textContent = 'Double 1... (Advantage)'; }
            else { document.getElementById('diceLabel').textContent = 'Advantage'; }
            if (diceToastTimeout) clearTimeout(diceToastTimeout);
            toast.classList.add('show');
            diceToastTimeout = setTimeout(() => toast.classList.remove('show'), 2500);
        }

        const spells = {
            "burn": { name: "Burn", level: "Cantrip", school: "Transmutation", type: "cantrip", castingTime: "Action", range: "Touch", components: "V, S", duration: "Instantaneous",
                description: "<p>You ignite a brilliant flame around your hand that sears anything you touch. Make a melee spell attack against a creature or object within range. On hit, the target takes 1d12 fire damage.</p>",
                upcast: "The spell's damage increases by 1d12 when you reach 5th level (2d12), 11th level (3d12), and 17th level (4d12)." },
            "true-strike": { name: "True Strike", level: "Cantrip", school: "Divination", type: "cantrip", castingTime: "Action", range: "Self", components: "S, M (a weapon with which you have proficiency worth 1+ CP)", duration: "Instantaneous",
                description: "<p>Guided by a flash of magical insight, you make one attack with the weapon used in the spell's casting. The attack uses your spellcasting ability for the attack and damage rolls instead of using Strength or Dexterity. If the attack deals damage, it can be Radiant damage or the weapon's normal damage type (your choice).</p>",
                upcast: "Whether you deal Radiant damage or the weapon's normal damage type, the attack deals extra Radiant damage when you reach levels 5 (1d6), 11 (2d6), and 17 (3d6)." },
            "electric-arc": { name: "Electric Arc", level: "Cantrip", school: "Evocation", type: "cantrip", castingTime: "Action", range: "60 feet", components: "V, S", duration: "Instantaneous",
                description: "<p>You shoot a jolt of lightning at a creature you can see within range. Make a ranged spell attack against the target. On hit, the target takes 1d8 primary lightning damage and an arc of lightning jumps from the target to another creature within 15 feet, using the same attack roll, dealing 1d4 secondary lightning damage on hit.</p>",
                upcast: "This spell's damage increases by 1d8 primary and 1d4 secondary damage when you reach 5th level (2d8 and 2d4), 11th level (3d8 and 3d4), and 17th level (4d8 and 4d4)." },
            "guidance": { name: "Guidance", level: "Cantrip", school: "Divination", type: "cantrip", castingTime: "Action", range: "Touch", components: "V, S", duration: "Concentration, up to 1 minute",
                description: "<p>You touch a willing creature and choose a skill. Until the spell ends, the creature adds 1d4 to any ability check using the chosen skill.</p>" },
            "ice-weapon": { name: "Ice Weapon", level: "Cantrip", school: "Transmutation", type: "cantrip", castingTime: "Bonus Action", range: "Self", components: "V, S, M (a drop of water that was once snow)", duration: "1 minute",
                description: "<p>You conjure a weapon formed from magical ice in your hand. You have proficiency with this weapon. When you form it and as a bonus action while wielding it, you can morph the weapon into different forms. If you lose or discard the weapon, you can reform it in your hand as a bonus action.</p><p>Regardless of its form, the weapon deals cold damage. You can end the spell early, letting the weapon melt to a harmless splash of water (no action required). You can have up to three ice weapons formed from this spell at a time. After forming a fourth, the first one melts away.</p><table style='width:100%; margin-top:10px; font-size:0.9em; border-collapse:collapse;'><tr style='background:var(--fire);color:#fff;'><th style='padding:4px;'>Weapon</th><th>Damage</th><th>Properties</th></tr><tr><td style='padding:4px;text-align:center;'>Ice Spear</td><td style='text-align:center;'>1d6</td><td>Thrown (30/90)</td></tr><tr style='background:rgba(0,0,0,0.05);'><td style='padding:4px;text-align:center;'>Ice Sword</td><td style='text-align:center;'>1d6</td><td>Versatile (1d8)</td></tr><tr><td style='padding:4px;text-align:center;'>Ice Lance</td><td style='text-align:center;'>1d8</td><td>Two-Handed, Reach</td></tr><tr style='background:rgba(0,0,0,0.05);'><td style='padding:4px;text-align:center;'>Ice Hammer</td><td style='text-align:center;'>1d10</td><td>Two-Handed, Heavy</td></tr><tr><td style='padding:4px;text-align:center;'>Ice Dagger</td><td style='text-align:center;'>1d4</td><td>Finesse, Thrown (30/90)</td></tr></table>" },
            "light": { name: "Light", level: "Cantrip", school: "Evocation", type: "cantrip", castingTime: "Action", range: "Touch", components: "V, M (a firefly or phosphorescent moss)", duration: "1 hour",
                description: "<p>You touch one object that is no larger than 10 feet in any dimension. Until the spell ends, the object sheds Bright Light in a 20-foot radius and Dim Light for an additional 20 feet. The light can be colored as you like.</p><p>Completely covering the object with something opaque blocks the light. The spell ends if you cast it again.</p>" },
            "identify": { name: "Identify", level: "1st", school: "Divination (Ritual)", type: "oracle", castingTime: "1 minute", range: "Touch", components: "V, S, M (a pearl worth at least 100 GP)", duration: "Instantaneous",
                description: "<p>You choose one object that you must touch throughout the casting of the spell. If it is a magic item or some other magic-imbued object, you learn its properties and how to use them, whether it requires Attunement to use, and how many charges it has, if any. You learn whether any ongoing spells are affecting the item and what they are. If the item was created by a spell, you learn that spell's name.</p><p>If you instead touch a creature throughout the casting, you learn which ongoing spells, if any, are currently affecting it.</p>" },
            "burning-hands": { name: "Burning Hands", level: "1st", school: "Evocation", type: "fire", castingTime: "Action", range: "Self (15-foot cone)", components: "V, S", duration: "Instantaneous",
                description: "<p>A thin sheet of flames shoots forth from you. Each creature in a 15-foot Cone makes a Dexterity saving throw, taking 3d6 Fire damage on a failed save or half as much damage on a successful one.</p><p>Flammable objects in the Cone that aren't being worn or carried start burning.</p>",
                upcast: "The damage increases by 1d6 for each spell slot level above 1." },
            "bless": { name: "Bless", level: "1st", school: "Enchantment", type: "war", castingTime: "Action", range: "30 feet", components: "V, S, M (a Holy Symbol worth 5+ GP)", duration: "Concentration, up to 1 minute",
                description: "<p>You bless up to three creatures within range. Whenever a target makes an attack roll or a saving throw before the spell ends, the target adds 1d4 to the roll.</p>",
                upcast: "You can target one additional creature for each spell slot level above 1." },
            "healing-word": { name: "Healing Word", level: "1st", school: "Abjuration", type: "life", castingTime: "Bonus Action", range: "60 feet", components: "V", duration: "Instantaneous",
                description: "<p>A creature of your choice that you can see within range regains Hit Points equal to 2d4 plus your spellcasting ability modifier (+4).</p>",
                upcast: "The healing increases by 2d4 for each spell slot level above 1." },
            "absorb-elements": { name: "Absorb Elements", level: "1st", school: "Abjuration", type: "normal", castingTime: "Reaction, which you take when you take Acid, Cold, Fire, Lightning, or Thunder damage", range: "Self", components: "S", duration: "1 round",
                description: "<p>The spell captures some of the incoming energy, lessening its effect on you and storing it for your next melee attack. You have Resistance to the triggering damage type until the start of your next turn. Also, the first time you hit with a melee attack on your next turn, the target takes an extra 1d6 damage of the triggering type.</p>",
                upcast: "The extra damage increases by 1d6 for each spell slot level above 1." },
            "detect-magic": { name: "Detect Magic", level: "1st", school: "Divination (Ritual)", type: "normal", castingTime: "Action", range: "Self (30-foot radius)", components: "V, S", duration: "Concentration, up to 10 minutes",
                description: "<p>For the duration, you sense the presence of magical effects within 30 feet of yourself. If you sense magic in this way, you can take a Magic action to see a faint aura around any visible creature or object in the area that bears the magic, and if an effect was created by a spell, you learn the spell's school of magic.</p><p>The spell can penetrate most barriers but is blocked by 1 foot of stone, 1 inch of common metal, a thin sheet of lead, or 3 feet of wood or dirt.</p>" },
            "locate-object": { name: "Locate Object", level: "2nd", school: "Divination", type: "oracle", castingTime: "Action", range: "Self", components: "V, S, M (a forked twig)", duration: "Concentration, up to 10 minutes",
                description: "<p>Describe or name an object that is familiar to you. You sense the direction to the object's location if that object is within 1,000 feet of you. If the object is in motion, you know the direction of its movement.</p><p>The spell can locate a specific object known to you if you have seen it up closeâ€”within 30 feetâ€”at least once. Alternatively, the spell can locate the nearest object of a particular kind, such as a certain kind of apparel, jewelry, furniture, tool, or weapon.</p><p>This spell can't locate an object if any thickness of lead blocks a direct path between you and the object.</p>" },
            "continual-flame": { name: "Continual Flame", level: "2nd", school: "Evocation", type: "fire", castingTime: "Action", range: "Touch", components: "V, S, M (ruby dust worth 50+ GP, which the spell consumes)", duration: "Until dispelled",
                description: "<p>A flame springs from an object that you touch. The effect casts Bright Light in a 20-foot radius and Dim Light for an additional 20 feet. It looks like a regular flame, but it creates no heat and doesn't consume oxygen. The flame can be covered or hidden but not smothered or quenched.</p>" },
            "iron-wind-strike": { name: "Iron Wind Strike", level: "2nd", school: "Conjuration", type: "war", castingTime: "Action", range: "Self (15-foot radius)", components: "V, S, M (a melee weapon you are proficient with worth at least 1 cp)", duration: "Instantaneous",
                description: "<p>You flourish a weapon you are proficient with used in the casting and then vanish to strike like the wind. Choose up to three creatures you can see within range. Make a melee weapon attack against each target. On a hit, a target takes 3d8 damage of the weapon's damage type.</p><p>You can then teleport to an unoccupied space you can see within 5 feet of one of the targets you hit or missed.</p>",
                upcast: "When you cast this spell using a spell slot of 3rd level or higher, it deals an additional 1d8 damage to each target on hit for each slot level above 2nd." },
            "aid": { name: "Aid", level: "2nd", school: "Abjuration", type: "life", castingTime: "Action", range: "30 feet", components: "V, S, M (a strip of white cloth)", duration: "8 hours",
                description: "<p>Choose up to three creatures within range. Each target's Hit Point maximum and current Hit Points increase by 5 for the duration.</p>",
                upcast: "Each target's Hit Points increase by 5 for each spell slot level above 2." },
            "enhance-ability": { name: "Enhance Ability", level: "2nd", school: "Transmutation", type: "normal", castingTime: "Action", range: "Touch", components: "V, S, M (fur or a feather)", duration: "Concentration, up to 1 hour",
                description: "<p>You touch a creature and choose Strength, Dexterity, Intelligence, Wisdom, or Charisma. For the duration, the target has Advantage on ability checks using the chosen ability.</p>",
                upcast: "You can target one additional creature for each spell slot level above 2. You can choose a different ability for each target." },
            "invisibility": { name: "Invisibility", level: "2nd", school: "Illusion", type: "normal", castingTime: "Action", range: "Touch", components: "V, S, M (an eyelash in gum arabic)", duration: "Concentration, up to 1 hour",
                description: "<p>A creature you touch has the Invisible condition until the spell ends. The spell ends early immediately after the target makes an attack roll, deals damage, or casts a spell.</p>",
                upcast: "You can target one additional creature for each spell slot level above 2." },
            "misty-step": { name: "Misty Step", level: "2nd", school: "Conjuration", type: "normal", castingTime: "Bonus Action", range: "Self", components: "V", duration: "Instantaneous",
                description: "<p>Briefly surrounded by silvery mist, you teleport up to 30 feet to an unoccupied space you can see.</p>" },
            "clairvoyance": { name: "Clairvoyance", level: "3rd", school: "Divination", type: "oracle", castingTime: "10 minutes", range: "1 mile", components: "V, S, M (a focus worth 100+ GP, either a jeweled horn for hearing or a glass eye for seeing)", duration: "Concentration, up to 10 minutes",
                description: "<p>You create an invisible sensor within range in a location familiar to you (a place you have visited or seen before) or in an obvious location that is unfamiliar to you (such as behind a door, around a corner, or in a grove of trees). The sensor remains in place for the duration.</p><p>When you cast the spell, choose seeing or hearing. You can use the chosen sense through the sensor as if you were in its space. As a Magic action, you can switch between seeing and hearing.</p><p>A creature that sees the sensor (such as a creature benefiting from See Invisibility or Truesight) sees a luminous orb about the size of your fist.</p>" },
            "fireball": { name: "Fireball", level: "3rd", school: "Evocation", type: "fire", castingTime: "Action", range: "150 feet", components: "V, S, M (a ball of bat guano and sulfur)", duration: "Instantaneous",
                description: "<p>A bright streak flashes from you to a point you choose within range and then blossoms with a low roar into a fiery explosion. Each creature in a 20-foot-radius Sphere centered on that point makes a Dexterity saving throw, taking 8d6 Fire damage on a failed save or half as much damage on a successful one.</p><p>Flammable objects in the area that aren't being worn or carried start burning.</p>",
                upcast: "The damage increases by 1d6 for each spell slot level above 3." },
            "whirling-conflagration": { name: "Whirling Conflagration", level: "3rd", school: "Transmutation", type: "war", castingTime: "Action", range: "Self (15-foot radius)", components: "V, M (a melee weapon you are proficient with worth at least 1 cp)", duration: "Instantaneous",
                description: "<p>You flourish the weapon used in the casting and then whirl it around, igniting it in whirling conflagration. Make a melee weapon attack against each creature within 15 feet (using the same roll against each creature). Each target takes 6d6 fire damage on hit, or half as much on a miss.</p>",
                upcast: "When you cast this spell using a spell slot of 4th level or higher, it deals an additional 1d6 damage to each target for each slot level above 3rd." },
            "mass-healing-word": { name: "Mass Healing Word", level: "3rd", school: "Abjuration", type: "life", castingTime: "Bonus Action", range: "60 feet", components: "V", duration: "Instantaneous",
                description: "<p>Up to six creatures of your choice that you can see within range regain Hit Points equal to 2d4 plus your spellcasting ability modifier (+4).</p>",
                upcast: "The healing increases by 1d4 for each spell slot level above 3." },
            "spirit-guardians": { name: "Spirit Guardians", level: "3rd", school: "Conjuration", type: "normal", castingTime: "Action", range: "Self (15-foot emanation)", components: "V, S, M (a prayer scroll)", duration: "Concentration, up to 10 minutes",
                description: "<p>Protective spirits flit around you in a 15-foot Emanation for the duration. If you are good or neutral, their spectral form appears angelic or fey (your choice). If you are evil, they appear fiendish.</p><p>When you cast this spell, you can designate creatures to be unaffected by it. Any other creature's Speed is halved in the Emanation, and whenever the Emanation enters a creature's space and whenever a creature enters the Emanation or ends its turn there, the creature must make a Wisdom save, taking 3d8 Radiant damage (if you are good or neutral) or 3d8 Necrotic damage (if you are evil) on a failed save or half as much damage on a successful one.</p>",
                upcast: "The damage increases by 1d8 for each spell slot level above 3." },
            "counterspell": { name: "Counterspell", level: "3rd", school: "Abjuration", type: "normal", castingTime: "Reaction, which you take when you see a creature within 60 feet casting a spell with Verbal, Somatic, or Material components", range: "60 feet", components: "S", duration: "Instantaneous",
                description: "<p>You attempt to interrupt a creature in the process of casting a spell. The creature makes a Constitution saving throw. On a failed save, the spell dissipates with no effect, and the action, Bonus Action, or Reaction used to cast it is wasted. If that spell was cast with a spell slot, the slot isn't expended.</p>" },
            "locate-creature": { name: "Locate Creature", level: "4th", school: "Divination", type: "oracle", castingTime: "Action", range: "Self", components: "V, S, M (fur from a bloodhound)", duration: "Concentration, up to 1 hour",
                description: "<p>Describe or name a creature that is familiar to you. You sense the direction to the creature's location if that creature is within 1,000 feet of you. If the creature is moving, you know the direction of its movement.</p><p>The spell can locate a specific creature known to you or the nearest creature of a specific kind (such as a human or a unicorn) if you have seen such a creature up closeâ€”within 30 feetâ€”at least once. If the creature you described or named is in a different form, such as being under the effects of a spell, this spell doesn't locate the creature.</p><p>This spell can't locate a creature if any thickness of running water at least 10 feet wide blocks a direct path between you and the creature.</p>" },
            "fire-shield": { name: "Fire Shield", level: "4th", school: "Evocation", type: "fire", castingTime: "Action", range: "Self", components: "V, S, M (a bit of phosphorus or a firefly)", duration: "10 minutes",
                description: "<p>Wispy flames wreathe your body for the duration, shedding Bright Light in a 10-foot radius and Dim Light for an additional 10 feet.</p><p>The flames provide you with a warm shield or a chill shield, as you choose. The warm shield grants you Resistance to Cold damage, and the chill shield grants you Resistance to Fire damage.</p><p>In addition, whenever a creature within 5 feet of you hits you with a melee attack roll, the shield erupts with flame. The attacker takes 2d8 Fire damage from a warm shield or 2d8 Cold damage from a chill shield.</p>" },
            "dimension-cutter": { name: "Dimension Cutter", level: "4th", school: "Conjuration", type: "war", castingTime: "Action", range: "Self (15-foot cone)", components: "V, M (a melee weapon you are proficient with worth at least 1 cp)", duration: "Instantaneous",
                description: "<p>You flourish a weapon you are proficient with used in the casting and sweep through the air, slashing apart the dimensional space. Each creature in a 15-foot cone takes 6d6 force damage. This passes through total cover and strikes creatures in the ethereal plane as well as the material plane.</p>",
                upcast: "When you cast this spell using a spell slot of 5th level or higher, it deals an additional 1d6 damage for each slot level above 4th." },
            "vital-surge": { name: "Vital Surge", level: "4th", school: "Transmutation", type: "life", castingTime: "1 minute", range: "30 feet", components: "V, S", duration: "8 hours",
                description: "<p>You infuse a vital surge of life into up to 4 creatures of your choice within range. Once during the duration of the spell, they can trigger this vital surge as a bonus action, regaining 4d8 hit points. When they trigger this surge, they can expend up to a number of hit dice equal to half the level of the spell slot used to cast this spell (2), rolling them as they normally would and adding the amount of hit points restored to the effect of this surge.</p><p>Once a creature triggers this healing surge, the spell ends for that creature.</p>",
                upcast: "When you cast this spell using a spell slot of 5th level or higher, you can target one additional creature for each slot level above 4th." },
            "conjure-woodland-beings": { name: "Conjure Woodland Beings", level: "4th", school: "Conjuration", type: "normal", castingTime: "Action", range: "Self (10-foot emanation)", components: "V, S", duration: "Concentration, up to 10 minutes",
                description: "<p>You conjure nature spirits that flit around you in a 10-foot Emanation for the duration. Whenever the Emanation enters the space of a creature you can see and whenever a creature you can see enters the Emanation or ends its turn there, you can force that creature to make a Wisdom saving throw. The creature takes 5d8 Force damage on a failed save or half as much damage on a successful one. A creature makes this save only once per turn.</p><p>In addition, you can take the Disengage action as a Bonus Action for the spell's duration.</p>",
                upcast: "The damage increases by 1d8 for each spell slot level above 4." },
            "banishment": { name: "Banishment", level: "4th", school: "Abjuration", type: "normal", castingTime: "Action", range: "30 feet", components: "V, S, M (a pentacle)", duration: "Concentration, up to 1 minute",
                description: "<p>One creature that you can see within range must succeed on a Charisma saving throw or be transported to a harmless demiplane for the duration. While there, the target has the Incapacitated condition. When the spell ends, the target reappears in the space it left or in the nearest unoccupied space if that space is occupied.</p><p>If the target is an Aberration, a Celestial, an Elemental, a Fey, or a Fiend, the target doesn't return if the spell lasts for 1 minute. The target is instead transported to a random location on a plane (DM's choice) associated with its creature type.</p>",
                upcast: "You can target one additional creature for each spell slot level above 4." }
        };

        function openSpellPopup(spellId) {
            const spell = spells[spellId];
            if (!spell) return;
            const overlay = document.getElementById('spellOverlay');
            const header = document.getElementById('spellHeader');
            header.className = 'spell-popup-header ' + (spell.type || '');
            document.getElementById('spellTitle').textContent = spell.name;
            document.getElementById('spellSubtitle').textContent = spell.level === 'Cantrip' ? `${spell.school} Cantrip` : `Level ${spell.level} ${spell.school}`;
            document.getElementById('spellMeta').innerHTML = `
                <div class="spell-meta-item"><span class="spell-meta-label">Casting Time:</span> ${spell.castingTime}</div>
                <div class="spell-meta-item"><span class="spell-meta-label">Range:</span> ${spell.range}</div>
                <div class="spell-meta-item"><span class="spell-meta-label">Components:</span> ${spell.components}</div>
                <div class="spell-meta-item"><span class="spell-meta-label">Duration:</span> ${spell.duration}</div>`;
            document.getElementById('spellDescription').innerHTML = spell.description;
            const upcast = document.getElementById('spellUpcast');
            if (spell.upcast) { upcast.innerHTML = `<strong>Higher Level:</strong> ${spell.upcast}`; upcast.style.display = 'block'; }
            else { upcast.style.display = 'none'; }
            overlay.classList.add('active');
        }
        function closeSpellPopup() { document.getElementById('spellOverlay').classList.remove('active'); }
        document.getElementById('spellOverlay').addEventListener('click', function(e) { if (e.target === this) closeSpellPopup(); });
        document.addEventListener('keydown', function(e) { if (e.key === 'Escape') closeSpellPopup(); });
        document.querySelectorAll('.spell-link').forEach(link => { link.addEventListener('click', function() { openSpellPopup(this.dataset.spell); }); });
    </script>
</body>
</html>
